# 模組五講義：特徵縮放與變數轉換的基礎

---

## 1. 本章學習框架 (Learning Framework)

- **第一原理 (First Principle)**: **特徵工程的目標是讓數據更好地服務於模型**。這包含兩個層面：
  1.  **公平性 (Fairness)**: 確保沒有任何一個特徵因為其原始的數值範圍過大而主導模型的學習過程。這是 **特徵縮放** 的核心。
  2.  **適應性 (Adaptation)**: 改變數據的分佈形狀，使其更符合某些模型（特別是線性模型）的內在假設（如常態性），從而提升模型性能。這是 **變數轉換** 的核心。

- **基礎 (Fundamentals)**: 本章節旨在教授處理數值特徵的兩大類 **核心基礎** 技術：
  1.  **特徵縮放 (Scaling)**: 只改變數據的 **尺度 (Scale)**，不改變其分佈形狀。
  2.  **變數轉換 (Transformation)**: 改變數據的 **分佈形狀 (Shape)**，使其更對稱或更接近常態分佈。

---

## 2. 特徵縮放 (Feature Scaling)

> *「將不同特徵的數值範圍調整到可比較的尺度...對於基於距離的演算法...以及使用梯度下降優化的模型...至關重要。」*

### 2.1 為何要縮放？
- **基於距離的模型 (Distance-Based)**: 如 KNN, K-Means, SVM。距離計算會被數值範圍大的特徵主導。
- **梯度下降優化的模型 (Gradient Descent-Based)**: 如線性/邏輯迴歸, 神經網路。統一的尺度有助於梯度下降算法更快、更穩定地收斂。

### 2.2 核心縮放方法比較

| 方法 | 英文名稱 | 原理 | 優點 | 缺點 & 風險 | 適用場景 (**關鍵**) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **標準化** | Standardization | 轉換為 **均值=0, 標準差=1**。 | 保留分佈形狀和異常值資訊，適用範圍廣。 | 縮放後的數據沒有固定範圍。 | **大多數演算法的預設首選**。 |
| **歸一化** | Normalization | 縮放到一個固定區間，通常是 **[0, 1]**。 | 數據範圍固定，直觀。 | **對異常值非常敏感**！一個極端值會壓縮所有其他數據點。 | 需要特定數據範圍的演算法（如圖像像素）。**使用前必須先處理異常值**。 |
| **穩健縮放** | Robust Scaling | 使用 **中位數** 和 **四分位距(IQR)** 進行縮放。 | **對異常值不敏感**，非常穩健。 | 可能不如標準化常用，但面對異常值時是最佳選擇。 | 當數據中**已知或懷疑存在異常值**時。 |

### 2.3 縮放的第一原理：防止數據洩漏
> *「務必先劃分數據（訓練集/驗證集/測試集）。所有的轉換器（Scaler, Encoder, Imputer）都應『僅』在訓練數據上進行 fit（學習參數），然後再對驗證集和測試集進行 transform（應用轉換）。」*

- **`fit()`**: 這個步驟是在 **學習** 數據的分佈特徵（均值、標準差、最大/最小值、IQR等）。
- **`transform()`**: 這個步驟是 **應用** 學習到的參數來轉換數據。

**黃金法則**: **只對訓練集 `fit()`，然後對訓練集和測試集 `transform()`**。這模擬了模型在現實世界中處理未知新數據的情景，是防止數據洩漏的根本保證。

---

## 3. 變數轉換 (Variable Transformation)

> *「處理偏態分佈（使其更接近常態分佈），穩定變異數，使關係線性化，減輕異常值的影響。」*

### 3.1 為何要轉換？
許多線性模型假設特徵和目標變數之間存在線性關係，或者特徵本身服從常態分佈。當數據高度偏斜時，這些假設被打破，模型性能會下降。冪轉換可以修正偏態，讓數據更符合模型假設。

### 3.2 核心轉換方法

| 轉換方法 | 原理 | 優點 | 限制 | 適用場景 |
| :--- | :--- | :--- | :--- | :--- |
| **對數轉換** | 取 `log(x)` 或 `log(1+x)` | 簡單、直觀，非常有效地修正 **右偏** 分佈。 | **僅適用於正數** (或非負數)。 | 處理金融數據、計數數據等常見的右偏資料。 |
| **Box-Cox** | 自動尋找最佳冪次 λ | 比手動試驗對數轉換更通用、更優化。 | **僅適用於正數**。 | 當你不確定最佳轉換方式，且數據為正時。 |
| **Yeo-Johnson**| Box-Cox 的推廣 | **可以處理 0 和負數**，適用性最強。 | 數學上更複雜，可解釋性稍差。 | 當數據中包含 0 或負數，且需要進行冪轉換時。 |

### 3.3 如何評估轉換效果？
- **視覺化**: 觀察轉換後分佈的直方圖 (`histplot`) 是否變得更對稱。
- **Q-Q 圖 (Quantile-Quantile Plot)**: 這是評估常態性的標準工具。如果轉換後的數據點緊密地落在對角線上，說明轉換效果很好。

---

## 4. 總結：一個系統化的流程
處理數值特徵時，推薦遵循以下流程：
1.  **EDA 檢視分佈**: 使用 `histplot` 和 `boxplot` 檢查每個特徵的分佈形狀和是否存在異常值。
2.  **制定策略**:
    - **對於偏態特徵**: **先用冪轉換修正偏態，再進行縮放**。 (e.g., `Log Transform` -> `StandardScaler`)
    - **對於近似常態的特徵**: 直接進行縮放。
    - **對於含有異常值的特徵**: 優先考慮使用 `RobustScaler`，或者先處理異常值再縮放。
3.  **應用**: 遵循 `fit on train, transform on test` 的原則應用所有處理步驟。 