# 模組六講義：特徵創造的基礎 (Fundamentals of Feature Creation)

---

## 1. 本章學習框架 (Learning Framework)

- **第一原理 (First Principle)**: **原始特徵往往是不夠的，特徵工程的真正藝術在於「創造」**。好的特徵創造能將隱含在數據中的、與業務邏輯緊密相關的模式，明確地轉化為模型可以學習的信號。這是從「數據使用者」轉變為「數據塑造者」的關鍵一步。

- **基礎 (Fundamentals)**: 本章節旨在教授特徵創造的三大 **核心基礎** 技術：
  1.  **交互特徵 (Interaction Features)**: 捕捉特徵間的協同效應。
  2.  **分組聚合特徵 (Group Aggregation Features)**: 從群體統計中洞察個體。
  3.  **時間衍生特徵 (Time-Derived Features)**: 讓時間戳說出背後的故事。

---

## 2. 交互特徵 (Interaction Features)

> *「捕捉兩個或多個特徵之間的組合效應...有助於模型理解非線性關係。」*

- **核心思想**: 兩個或多個特徵的影響力不是簡單相加，而是存在乘數效應或條件關係。
- **實現方式**:
  - **數值 x 數值**:
    - **相加/減**: `總面積 = 地上面積 + 地下室面積`；`房齡 = 賣出年份 - 建造年份`。
    - **相乘**: `加權品質 = 總體品質 * 總面積`。
    - **相除**: `地下室佔比 = 地下室面積 / 總面積`。
  - **數值 x 類別**:
    - 通常透過分組聚合實現，例如 `特徵 = 數值 - 該數值在其所屬類別中的平均值`。
- **風險**:
  - **特徵爆炸**: 不要盲目地將所有特徵兩兩組合，這會產生大量冗餘且無用的特徵。
  - **過度擬合**: 過於複雜的交互項可能會讓模型學習到噪音。
- **創建時機**: 基於 EDA 的發現（例如，散點圖呈現出分群的趨勢）或領域知識。

---

## 3. 分組聚合特徵 (Group Aggregation Features)

- **核心思想**: 一個樣本的群體歸屬（它屬於哪個城市、哪個部門、哪個用戶）是非常重要的資訊。我們可以通過計算該群體的統計特徵，來豐富個體樣本的表達。
- **實現流程 (The Golden Trio)**:
  1.  **`groupby('類別特徵')`**: 確定你要劃分的群體。可以是一個欄位，也可以是多個欄位的組合。
  2.  **`.agg(['統計方法1', '統計方法2', ...])`**: 對每個群體，計算其在某個數值特徵上的多種統計量。
      - **常用統計量**: `mean`, `std` (標準差), `sum`, `count`, `min`, `max`, `nunique` (唯一值計數), `median`, `skew` (偏度)。
  3.  **`.merge()`**: 將計算出的群體統計特徵合併回原始的每一個樣本上。
- **`transform()` vs `agg()`**:
  - 如果你只需要計算 **一個** 統計量並直接作為新欄位，`transform()` 更簡潔（`df['new_col'] = df.groupby('group_col')['val_col'].transform('mean')`）。
  - 如果你需要計算 **多個** 統計量，`agg()` + `merge()` 的組合更強大、更靈活。

---

## 4. 時間衍生特徵 (Time-Derived Features)

> *「從日期時間變數中提取年、月、日、星期幾、小時、是否週末、時間差等成分，對於時間序列或事件相關數據至關重要。」*

- **第一原理檢查**: 一個 `YYYY-MM-DD HH:MM:SS` 格式的時間戳對模型來說只是一個無法理解的物件。我們的任務是將其分解為模型可以理解的、有意義的數值成分。
- **實現流程**:
  1.  **確保型態**: 使用 `pd.to_datetime()` 將欄位轉換為 `datetime64` 型態。這是所有操作的前提。
  2.  **使用 `.dt` 存取器**: 這是你的瑞士軍刀，可以輕鬆提取：
      - **基礎成分**: `.dt.year`, `.dt.month`, `.dt.day`, `.dt.hour`...
      - **週期成分**: `.dt.dayofweek` (星期幾), `.dt.quarter` (季度), `.dt.isocalendar().week` (年中的第幾週)...
      - **布林特徵**: `.dt.is_month_start` (是否月初), `.dt.is_weekend` (是否週末)...
  3.  **計算時間差 (`timedelta`)**:
      - **與固定點的差距**: `df['Timestamp'] - '固定日期'`，可以反映總體時間趨勢。
      - **事件間的差距**: `df.groupby('用戶')['Timestamp'].diff()`，可以捕捉用戶行為的頻率。

---

## 5. 總結

特徵創造是從「理解數據」到「塑造數據」的飛躍，是特徵工程中最能體現分析師創造力和洞察力的環節。本章介紹的三大技術——交互、聚合、時間衍生，是任何資料科學家工具箱中的必備利器。始終記住，好的特徵創造不是盲目的，而是由 **EDA 的發現** 和 **領域知識** 所驅動的。 