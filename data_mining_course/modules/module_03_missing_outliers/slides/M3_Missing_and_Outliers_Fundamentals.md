# 模組三講義：缺失值與異常值處理的基礎

---

## 1. 本章學習框架 (Learning Framework)

- **第一原理 (First Principle)**: **數據中的「無」與「極端」皆是資訊**。我們的首要任務是理解這些特殊值的成因與意涵，而非草率地將其刪除或用機械化的方法替代。錯誤的處理方式會扭曲數據的真實分佈，引入偏見，最終導致分析結論的錯誤。

- **基礎 (Fundamentals)**: 本章節旨在教授處理兩類最常見數據品質問題的 **核心基礎**：
  1.  **缺失值 (Missing Values)**: 如何理解、視覺化並選擇恰當的填充策略。
  2.  **異常值 (Outliers)**: 如何偵測、理解並為後續處理做準備。

---

## 2. 深入理解缺失值 (Missing Values)

> *「誤解缺失數據：簡單地假設缺失是隨機發生的，而實際上可能是系統性缺失...直接刪除行或列可能引入偏見。」*

### 2.1 缺失值的類型：理解「為何缺失」

| 類型 | 英文全稱 | 定義 | 例子 | 處理思路 |
| :--- | :--- | :--- | :--- | :--- |
| **完全隨機缺失** | MCAR | 缺失與任何數據都無關，純屬偶然。 | 資料輸入員隨機漏打。 | 刪除法相對安全，但仍損失數據。 |
| **隨機缺失** | MAR | 缺失與 **其他觀測變數** 有關。 | 男性比女性更不願填寫某問卷。 | 這是多數進階插補方法的前提。 |
| **非隨機缺失** | MNAR | 缺失與 **自身未觀測的值** 有關。 | 高收入者不願填寫薪資。**或缺失本身就是一種資訊**。 | **需要特別小心**，通常應創建新類別或常數來標示。 |

**核心洞察**: 在 House Prices 資料集中，大量缺失（如 `PoolQC`, `GarageType`）屬於 **MNAR**，它們的缺失代表 **"不存在該設施"**。這是有價值的資訊，必須保留。

### 2.2 處理策略：從刪除到插補

- **刪除法**:
  - **優點**: 簡單快速。
  - **缺點**: **嚴重損失資訊**，當缺失非 MCAR 時會**引入偏見**。
  - **適用**: 缺失比例極低，或某列幾乎全空且不重要時。

- **插補法 (Imputation)**: 用估計值填補缺失，保留數據點。

| 插補方法 | 策略 | 優點 | 缺點 & 風險 | 適用場景 |
| :--- | :--- | :--- | :--- | :--- |
| **單變數統計** | 均值/中位數/眾數 | 簡單、快速、易於實現。 | **嚴重扭曲數據分佈** (產生尖峰)、低估變異數、破壞特徵相關性。 | 快速原型開發、缺失比例極低。 |
| **單變數常數** | 填充為 0, "None" 等 | **能保留 MNAR 的資訊**。 | 需有明確的業務邏輯支持。 | **當缺失代表「無」或一種特定狀態時，這是最佳選擇。** |
| **多變數** | K-近鄰 (KNN) | 利用特徵間關係，**更能維持原始數據分佈**。 | 計算成本高，對異常值敏感。 | 希望得到更精確的插補結果，且特徵間有關聯時。 |

---

## 3. 深入理解異常值 (Outliers)

> *「防止異常值扭曲統計量（如均值）、干擾模型訓練（尤其是線性模型、基於距離的演算法），或違反模型假設。」*

### 3.1 偵測策略：視覺化與統計規則

- **視覺化偵測**:
  - **箱型圖 (Box Plot)**: 檢測單變數異常值的首選，直觀顯示超出 `1.5 * IQR` 範圍的點。
  - **散點圖 (Scatter Plot)**: 檢測雙變數關係中的異常點，對於發現那些「不合群」的數據點（如面積很大但價格極低）非常有效。

- **統計規則偵測**:

| 偵測方法 | 原理 | 優點 | 缺點 & 風險 | 適用場景 |
| :--- | :--- | :--- | :--- | :--- |
| **IQR 法則** | `Q1 - 1.5*IQR` & `Q3 + 1.5*IQR` | **對數據分佈無假設，對偏態數據穩健。** | 1.5 這個乘數是經驗值，不一定普適。 | 大多數情況下的 **首選統計方法**。 |
| **Z-Score 法** | `| (x - μ) / σ | > 3` | 統計意義明確。 | **假設數據服從常態分佈**，對偏態和異常值本身都很敏感。 | 數據分佈接近常態時。 |

### 3.2 處理異常值的核心原則

**偵測到異常值後，最重要的步驟是「調查」，而不是「刪除」。**

1.  **問自己**: 這個異常值是真實的極端案例（如億萬富翁的房價），還是數據輸入錯誤（如多打了一個零）？
2.  **評估影響**: 這個點對你的分析目標和後續模型有多大的干擾？（例如，對線性迴歸影響巨大，對樹模型影響較小）。
3.  **選擇策略**:
    - **刪除**: 僅當你**非常確定**這是個錯誤時。
    - **轉換 (Transformation)**: 如對數轉換，可以減輕異常值的影響。
    - **縮尾 (Winsorization)**: 用較小（如 99%）的百分位數替換極端值。
    - **保留**: 如果它是真實且重要的資訊，或者你的模型對其不敏感。

---

## 4. 總結

處理缺失值與異常值是特徵工程中最能體現「資料啟發 (Data-Informed)」思想的環節。它要求我們不僅僅是應用技術，更是結合業務邏輯、批判性思維和對數據的深刻理解，來做出最合理的決策。 